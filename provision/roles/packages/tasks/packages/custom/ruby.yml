---
- name: install rbenv
  git:
    repo: https://github.com/rbenv/rbenv.git
    dest: ~/.rbenv
    force: yes

- name: install ruby-build
  git:
    repo: https://github.com/rbenv/ruby-build.git
    dest: ~/.rbenv/plugins/ruby-build
    force: yes

- name: install ruby {{ ruby_version }}
  command: ~/.rbenv/bin/rbenv install {{ ruby_version }}
  args:
    creates: ~/.rbenv/versions/{{ ruby_version }}
  notify:
    - update default ruby

- name: install ruby packages
  gem:
    name: "{{ item }}"
    state: present
    user_install: false
    executable: ~/.rbenv/versions/{{ ruby_version }}/bin/gem
  with_items: "{{ gem_packages }}"
  notify:
    - update rbenv shims

- name: initial bundle folder
  file:
    path: ~/.bundle
    state: directory

- name: copy bundle config
  copy:
    src: files/ruby/bundle/config
    dest: ~/.bundle
    force: yes
