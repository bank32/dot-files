---
- name: install rbenv
  git:
    repo: https://github.com/rbenv/rbenv.git
    dest: ~/.rbenv
    force: yes

- name: install ruby-build
  git:
    repo: https://github.com/rbenv/ruby-build.git
    dest: ~/.rbenv/plugins/ruby-build
    force: yes

- name: install ruby
  command: ~/.rbenv/bin/rbenv install {{ item }}
  args:
    creates: ~/.rbenv/versions/{{ item }}
  with_items: "{{ ruby_versions }}"
  notify:
    - update default ruby

- name: install ruby packages
  gem:
    name: "{{ item }}"
    state: present
    user_install: false
    executable: ~/.rbenv/versions/{{ default_ruby_version }}/bin/gem
  with_items: "{{ gem_packages }}"
  notify:
    - update rbenv shims

- name: initial bundle folder
  file:
    path: ~/.bundle
    state: directory

- name: copy bundle config
  copy:
    src: files/ruby/bundle/config
    dest: ~/.bundle
    force: yes
